{% extends 'base.html.twig' %}

{% block body %}

<div class="container">

    <h3 class="h3 mb-3 font-weight-normal">{{ question.title }}</h3>
    <p>Question posé par 
        <span class="strong">{{ question.user.userName }}</span> le
        <span class="strong">{{ question.createdAt | date('Y-m-d') }}</span>
    </p>
    <p>{{ question.body }}</p>
    <div class="responses-container">

{% for response in responses %}

    <div class="card bg-{% if question.correctResponse.id is defined and question.correctResponse.id == response.id %}warning correct-response
                        {% else %}light wrong-response
                        {% endif %}mb-3">
        <div class="card-header">
            <p>Réponse le 
                <span class="strong">{{ response.createdAt | date('Y-m-d') }}</span> par
                <span class="strong">{{ response.user.userName }}</span>
            </p>
            {% if question.correctResponse.id is defined and question.correctResponse.id == response.id %}
            <span class="strong">Réponse validée</span>
            {% elseif app.user.id is defined and app.user.id == question.user.id %}
            <form method="POST" action="{{ path('select_response', {'question':question.id, 'response':response.id}) }}">
                <button class="btn btn-lg btn-warning btn-correct-response" type="submit">
                    Valider
                </button>
            </form>
            {% endif %}
            {% if is_granted('ROLE_ADMIN') %}
            <form method="POST" action="{{ path('moderate_response', {'response': response.id}) }}">
                <button class="btn btn-lg btn-danger btn-correct-response" type="submit">
                    Modérer
                </button>
            </form>
            {% endif %}
        </div>
        <div class="card-body">
            <p class="card-text">{{ response.body }}</p>
        </div>
    </div>

{% endfor %}

    </div>

{% if is_granted(['ROLE_ADMIN', 'ROLE_USER']) %}

<h3>Répondre à la question</h3>

{{ form_start(responseForm, { 'attr' : { 'class': 'form-container' } }) }}
    <div class="my-custom-class-for-errors">
        {{ form_errors(responseForm) }}
    </div>

    <div class="form-group row">
        <div class="col-sm-10">
            {{ form_widget(responseForm.body, { 'attr': { 'class' : 'form-control form-response', 'placeholder' : 'Répondre à la question'}} ) }}
        </div>
    </div>
    <div>
        {{ form_widget(responseForm.save, { 'attr': { 'class' : 'btn btn-primary'}} ) }}
    </div>
{{ form_end(responseForm) }}

{% endif %}

</div>

{% endblock %}